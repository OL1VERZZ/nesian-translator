<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nesian Translator</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        textarea { width: 80%; height: 100px; margin-bottom: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        p { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Nesian Translator</h1>
    <textarea id="inputText" placeholder="Enter English text..."></textarea>
    <br>
    <button onclick="translateText()">Translate</button>
    <p>Output:</p>
    <textarea id="outputText" readonly></textarea>

    <script>
        function translateText() {
            let input = document.getElementById("inputText").value;
            let output = translateToNesian(input);
            document.getElementById("outputText").value = output;
        }

        function translateToNesian(input) {
            const alphabetMap = {
                'a': 'āù', 'b': 'bè', 'c': 'ç', 'd': 'dè', 'e': 'è', 'f': 'f', 'g': 'g', 'h': 'h', 'i': 'è', 'j': 'j',
                'k': 'c', 'l': 'l', 'm': 'mē', 'n': 'nē', 'o': 'ò', 'p': 'p', 'q': 'q', 'r': 'r', 's': 'ç', 't': 'chò',
                'u': 'ù', 'v': 'v', 'w': "'", 'x': 'x', 'y': 'yù', 'z': 'z',
                'A': 'Āù', 'B': 'Bè', 'C': 'Ç', 'D': 'Dè', 'E': 'È', 'F': 'F', 'G': 'G', 'H': 'H', 'I': 'È', 'J': 'J',
                'K': 'C', 'L': 'L', 'M': 'Mē', 'N': 'Nē', 'O': 'Ò', 'P': 'P', 'Q': 'Q', 'R': 'R', 'S': 'Ç', 'T': 'Chò',
                'U': 'Ù', 'V': 'V', 'W': "'", 'X': 'X', 'Y': 'Yù', 'Z': 'Z'
            };

            // Step 1: Direct Letter Translation
            let translated = input.split('').map((char, index, arr) => {
                if (char === 'I' && input.trim() === 'I') return 'Ē'; // Rule for "I" as oneself
                if (char === 'i' && input.trim() === 'i') return 'ē'; // Lowercase "I" as oneself
                return alphabetMap[char] || char; // Preserve spaces & punctuation
            }).join('');

            // Step 2: Æ/Œ Rule (Handles both directions of fusion, including Ē)
            translated = translated.replace(/āù[èē]|[èē]āù/gi, 'æù');
            translated = translated.replace(/ò[èē]|[èē]ò/gi, 'œ');

            // Step 3: Thorn (Þ) Rule (Handles capitalization)
            translated = translated.replace(/Chòh/g, 'Þ'); // Capital "TH"
            translated = translated.replace(/ChòH/g, 'Þ'); // Mixed-case "Th"
            translated = translated.replace(/chòh/g, 'þ'); // Lowercase "th"

            // Step 4: Apostrophe Rule (Ensure 'W' translates correctly and remove original apostrophes)
            translated = translated.replace(/(?<!')'/g, ""); // Remove original apostrophes, keeping W-translated ones

            // Step 5: Accents Rule
            translated = applyAccentsRule(translated);

            return translated;
        }

        function applyAccentsRule(text) {
            let vowelsWithMarks = ['Ā', 'È', 'Ò', 'Ù', 'ā', 'è', 'ò', 'ù'];
            let lastAccent = '';
            let result = '';

            for (let char of text) {
                if (vowelsWithMarks.includes(char)) {
                    let accentType = char[0];
                    if (accentType === lastAccent) {
                        result += char.toLowerCase(); // Remove accent visually if same as previous vowel
                    } else {
                        result += char; // Keep the accent if it's different
                        lastAccent = accentType;
                    }
                } else {
                    result += char;
                }
            }
            return result;
        }
    </script>
</body>
</html>
